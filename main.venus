##Init
love.graphics.setDefaultFilter('nearest', 'nearest')
love.graphics.setBackgroundColor({18, 78, 137, 255})

##Libraries
require('core.helpers')
pprint = require('core.tableprint')(require('core.serpent'))

##Classes
local camera = require('game.Camera')
local player = require('game.Player')
local chunks = require('game.Chunks')
local profiler = require('lib.profiler')
local slideParticles = require('game.SlideParticles')

fn love.load() {
  ##Create inputs and assign controls
  Input = require('data.controls')

  ##Background Image
  BGimage = love.graphics.newImage('imgs/background.png')

  ##Particle Systems
  SlideParticles = slideParticles()

  ##Create chunks and player
  Chunks = chunks()
  Chunks:init()
  local firstChunkEntry = Chunks:getCurrent().inArrow
  Player = player((Chunks:getCurrent().xOffset * 16) + (firstChunkEntry.x * 16), (Chunks:getCurrent().yOffset * 16) + ((firstChunkEntry.y - 3) * 16), Chunks:getCurrent())

  ##Create camera and point it at player
  Camera = camera()
  Camera:lookAt(Player:getPos())
  Camera.scale = 2
}

fn love.update(dt) {
  Input:update()
  Chunks:update()
  Player:update(dt)
  Camera:trackPlayer()
}

fn love.draw() {
  love.graphics.draw(BGimage, 0, -200, 0, 2)
  Camera:attach()
  Chunks:draw()
  Player:draw()
  Camera:detach()
}
